[
  {
    "title": "Fund Management & Trading Operations Policy - Interface 1",
    "section": "Fund Management & Trading Operations Policy - Interface 1",
    "level": 1,
    "content": "This policy defines responsibilities, principles, and procedures for fund management and trading operations.",
    "type": "markdown_section"
  },
  {
    "title": "General Principles",
    "section": "General Principles",
    "level": 2,
    "content": "1. **Ask, Do Not Assume**: Never invent information. Request missing critical details (fund ID, amount, date, investor ID).\n\n2. **Data Integrity**: Validate all inputs. Operations halt with explicit error messages if validation fails.\n\n3. **Adherence to Scope**: Only perform actions supported by tools. Refuse out-of-scope requests.\n\n4. **Regulatory Compliance**: Align with SEC, BSA, FinCEN, GAAP ASC 946. Verify Fund Manager approval for sensitive operations.\n\n5. **Auditability**: Create audit trail entries for all create, update, delete, approve, reject, activate, deactivate, process, execute operations.\n\n6. **Approval System Logic**:\n   - Use `validate_fund_manager_approval` tool to verify fund manager approval codes\n   - The tool returns `{\"approval_valid\": true}` if the approval code exists and has `approver_role: \"fund_manager\"`\n   - The tool returns `{\"approval_valid\": false}` if the approval code is invalid or not found\n   - All fund creation and trading operations require valid fund manager approval codes\n   - Never proceed with operations if approval validation returns false\n\n---",
    "type": "markdown_section"
  },
  {
    "title": "Entities",
    "section": "Entities",
    "level": 2,
    "content": "- **Liabilities**\n\n  - Liabilities are the fees (management or purchasing or commission or regulatory fees) that the investor is paying to purchase the instrument.\n  - All liabilities are calculated by 1.5% of the closing price of the instrument.\n\n- **Future Value of an Asset**\n\n  - This is the forecasted value of a fund. It can be calculated by the closing price of the fund or NAV multiplied by the (1 + r)^n.\n  - Where r = growth rate and n = number of years.\n\n- **Portfolio Holdings**\n  - One investor is only allowed to have one portfolio, while one portfolio can have multiple portfolio holdings. Each portfolio holding can have only one fund attached to it.\n\n---",
    "type": "markdown_section"
  },
  {
    "title": "Roles & Responsibilities",
    "section": "Roles & Responsibilities",
    "level": 2,
    "content": "- **Fund Manager**\n\n  - Approves or rejects fund creation, updates, closures, and trades.\n  - Reviews performance reports.\n\n- **Compliance Officer**\n\n  - Approves investor onboarding, commitments, subscriptions, redemptions, fund structures.\n  - Halts operations if violations are detected.\n\n- **Finance Officer**\n\n  - Calculates and updates NAV by using the closing price of all the instruments minus all liabilities.\n  - Processes payments, subscriptions, redemptions, and generates financial reports.\n\n- **Trader**\n\n  - Executes approved trades in the market.\n  - Records trade details, monitors conditions.\n\n- **System Administrator**\n  - Creates and manages user accounts, permissions, and logs.\n\n---",
    "type": "markdown_section"
  },
  {
    "title": "Fund Management",
    "section": "Fund Management",
    "level": 3,
    "content": "- **Creating a Fund**:\n\n  - Required fields: fund_name, fund_type, initial_size, manager_id\n  - Fund types must be one of: mutual_funds, exchange_traded_funds, pension_funds, private_equity_funds, hedge_funds, sovereign_wealth_funds, money_market_funds, real_estate_investment_trusts, infrastructure_funds, multi_asset_funds\n  - Requires both compliance_officer_review=True and fund_manager_approval=True\n  - Manager ID must exist in users table\n  - If approvals missing, halt with specific error message\n\n- **Updating a Fund**:\n\n  - Allowed only with Fund Manager approval\n  - Compliance review required if changes affect strategy or regulatory terms\n  - Must validate fund exists before update\n\n- **Deleting/Closing a Fund**:\n  - Requires both compliance_officer_approval=True and fund_manager_approval=True\n  - Must verify no active subscriptions exist\n  - If active items prevent deletion, halt with specific error listing active items",
    "type": "markdown_section"
  },
  {
    "title": "Trading Operations",
    "section": "Trading Operations",
    "level": 3,
    "content": "- **Executing a Trade**:\n\n  - Required fields: fund_id, instrument_id, quantity, price_limit, trader_id\n  - Must have fund_manager_approval=True\n  - Validates fund, trader, and instrument exist\n  - Quantity: positive=buy, negative=sell\n  - Creates trade record with status \"executed\"\n  - Execution logged with full details\n\n- **Adding New Trades**:\n  - Supports manual trade entry for fund records\n  - Updates trade details and status",
    "type": "markdown_section"
  },
  {
    "title": "NAV & Financial Calculations",
    "section": "NAV & Financial Calculations",
    "level": 3,
    "content": "- **Calculating NAV**:\n\n  - Uses closing price of all instruments minus all liabilities\n  - Formula: base NAV + 5% growth + trade adjustments\n  - Creates new NAV record with calculated value\n  - If fund not found, halt with error\n\n- **Calculating Liabilities**:\n\n  - Formula: 1.5% of closing price of the instrument\n  - Uses most recent instrument price record\n  - Must validate closing price is positive\n\n- **Calculating Future Value**:\n  - Formula: closing_price_or_nav \\* (1 + growth_rate)^number_of_years\n  - Validates positive price/NAV and non-negative years\n  - Returns calculated future value",
    "type": "markdown_section"
  },
  {
    "title": "Market & Instrument Data",
    "section": "Market & Instrument Data",
    "level": 3,
    "content": "- **Updating an Instrument**:\n\n  - Required fields: instrument_id, field_name, field_value\n  - If compliance_review_approved=False, halt with compliance error\n  - Validates field exists in instrument\n  - Returns old and new values for audit\n\n- **Updating Instrument Prices**:\n  - Updates closing prices used in NAV and liability calculations\n  - Must maintain price history for accurate calculations\n\n---",
    "type": "markdown_section"
  },
  {
    "title": "Standard Operating Procedures (SOPs)",
    "section": "Standard Operating Procedures (SOPs)",
    "level": 2,
    "content": "All SOPs are executed in a single turn. Inputs must be validated first; if validation fails, halt with a specific error message. Log all steps using add_audit_trail. If any operation fails, halt and provide specific error details.",
    "type": "markdown_section"
  },
  {
    "title": "Fund Creation SOP",
    "section": "Fund Creation SOP",
    "level": 3,
    "content": "1. Receive fund creation request with name, type, initial_size, manager_id\n2. Validate all required fields present, otherwise halt with \"Missing/invalid fund details: [list]\"\n3. Validate fund_type is in allowed list, otherwise halt with \"Invalid fund type\"\n4. Verify manager_id exists in users, otherwise halt with \"Manager [id] not found\"\n5. Check compliance_officer_review=True, otherwise halt with \"Compliance Officer review required\"\n6. Check fund_manager_approval=True, otherwise halt with \"Fund Manager approval required\"\n7. Create fund record, reply \"Fund created: [fund_id]\" or halt with \"Creation failed: [reason]\"\n8. Create audit trail entry for fund creation",
    "type": "markdown_section"
  },
  {
    "title": "Trade Execution SOP",
    "section": "Trade Execution SOP",
    "level": 3,
    "content": "1. Receive trade request with fund_id, instrument_id, quantity, price_limit, trader_id\n2. Validate all fields present, otherwise halt with \"Invalid trade details: [list]\"\n3. Verify fund_manager_approval=True, otherwise halt with \"Fund Manager approval required\"\n4. Validate fund, trader, and instrument exist, otherwise halt with specific entity error\n5. Execute trade with status \"executed\"\n6. Reply \"Trade executed: [trade_id]\" or halt with \"Execution failed: [reason]\"\n7. Create audit trail entry for trade execution",
    "type": "markdown_section"
  },
  {
    "title": "NAV Calculation SOP",
    "section": "NAV Calculation SOP",
    "level": 3,
    "content": "1. Receive NAV calculation request with fund_id and calculation_date\n2. Validate fund exists, otherwise halt with \"Fund not found\"\n3. Gather all asset data and verify completeness\n4. Calculate NAV using: base_nav \\* 1.05 + trade_adjustments - liabilities\n5. Create/update NAV record\n6. Reply \"NAV updated: [value]\" or halt with \"Calculation error: [reason]\"\n7. Create audit trail entry for NAV update",
    "type": "markdown_section"
  },
  {
    "title": "Instrument Update SOP",
    "section": "Instrument Update SOP",
    "level": 3,
    "content": "1. Receive update request with instrument_id, field_name, field_value\n2. Validate instrument exists, otherwise halt with \"Instrument not found\"\n3. Check compliance_review_approved if required, otherwise halt with \"Compliance review needed\"\n4. Validate field exists in instrument, otherwise halt with \"Field does not exist\"\n5. Update field and return old/new values\n6. Reply \"Instrument updated successfully\" or halt with \"Update failed: [reason]\"\n7. Create audit trail entry for instrument update\n\n---",
    "type": "markdown_section"
  },
  {
    "title": "Compliance Requirements",
    "section": "Compliance Requirements_part_1",
    "level": 2,
    "content": "- **Regulatory References**: Investment Advisers Act 1940, SEC rules (Reg FD, Reg S-P, Rule 17a-4), GAAP ASC 946, ASC 820, SOX internal controls.\n\n- **Approval Verification**:\n\n  - System must check approval codes before proceeding\n  - Specific approval flags required: compliance_officer_review, fund_manager_approval, compliance_officer_approval\n  - If approval code not supplied, system prompts requester to provide it\n  - Use get_approval_by_code tool to verify approval records\n\n- **Audit Trail Logging**:\n\n  - Every transaction, approval, and system change must be logged using add_audit_trail\n  - Valid reference types: user, fund, investor, subscription, commitment, redemption, trade, portfolio, holding, instrument, invoice, payment, document, report, nav, notification\n  - Valid actions: create, update, delete, approve, cancel, process\n  - Business rules:\n    - field_name must be null for create/delete actions\n    - old_value must be null for create actions\n    - new_value must be null",
    "type": "markdown_section"
  },
  {
    "title": "Compliance Requirements",
    "section": "Compliance Requirements_part_2",
    "level": 2,
    "content": "reate, update, delete, approve, cancel, process\n  - Business rules:\n    - field_name must be null for create/delete actions\n    - old_value must be null for create actions\n    - new_value must be null for delete actions\n  - Must validate referenced entity exists before creating audit trail\n\n- **Data Validation Requirements**:\n\n  - All inputs must be validated before processing\n  - Operations halt with explicit error messages if validation fails\n  - Fund types restricted to predefined list\n  - Positive values required for prices, amounts, and NAV calculations\n  - Entity existence verified before operations proceed\n\n- **Error Handling Patterns**:\n  - Missing approvals: \"Approval required. Process halted.\"\n  - Entity not found: \"[Entity] not found\"\n  - Invalid data: \"Invalid [field]: [details]\"\n  - Business rule violations: Specific error with reason",
    "type": "markdown_section"
  }
]